// Generated by CoffeeScript 1.8.0
(function() {
  var http, qs, _;

  http = require('http');

  _ = require('underscore')._;

  qs = require('querystring');

  module.exports = {
    curl: function(options, callback) {
      var request;
      options = _.defaults(options, {
        method: 'GET',
        port: 80,
        headers: {
          'User-Agent': "pat the campfire bot, https://github.com/abachman/pat-the-campfire-bot"
        }
      });
      if (options.params != null) {
        options.path = options.path + "?" + qs.stringify(options.params);
      }
      console.log("making request with options: " + JSON.stringify(options));
      request = http.request(options, function(response) {
        var data;
        console.log('STATUS:  ' + response.statusCode);
        console.log('HEADERS: ' + JSON.stringify(response.headers));
        data = '';
        response.on('data', function(chunk) {
          return data += chunk;
        });
        return response.on('end', function() {
          return callback(data);
        });
      });
      return request.end();
    },
    getClientIp: function(request) {
      var forwardedIps, forwardedIpsStr, ipAddress;
      forwardedIpsStr = request.headers['x-forwarded-for'];
      if (forwardedIpsStr) {
        forwardedIps = forwardedIpsStr.split(',');
        ipAddress = forwardedIps[0];
      }
      if (!ipAddress) {
        ipAddress = request.connection.remoteAddress;
      }
      return ipAddress;
    }
  };

}).call(this);
