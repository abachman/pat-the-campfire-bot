<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Pat the Campfire Bot by abachman</title>
    
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Pat the Campfire Bot</h1>
        <p>A Campfire chat bot in node.js, intended to run on Heroku. Built for internal use at Figure53 but you might like it..</p>
        <p class="view"><a href="https://github.com/abachman/pat-the-campfire-bot">View the Project on GitHub <small>abachman/pat-the-campfire-bot</small></a></p>
        <ul>
          <li><a href="https://github.com/abachman/pat-the-campfire-bot/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/abachman/pat-the-campfire-bot/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/abachman/pat-the-campfire-bot">Fork On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>Pat the Campfire Bot</h1>

<p>Is what it is, does what it says. In the days before <a href="http://hubot.github.com">hubot</a> we had to write our own campfire bots and we liked it.</p>

<p>node.js so that it runs on Heroku. What do you know about bacon strips?</p>

<p>There are lots of dangling features, some extraneous code and the tests and
specs are more like sanity checks. Feel free to ignore anything ugly. </p>

<p>This is my, "hey, I should learn node.js" project and most of it was written in
a burst of activity over the weekend of 2011-07-23.</p>

<h2>dependencies</h2>

<p>Pat the bot is developed against: </p>

<ul>
<li>Javascript

<ul>
<li>node - 0.4.7</li>
<li>npm - 1.0.18</li>
<li>underscore - 1.1.7</li>
<li>dom-js - 0.0.1</li>
<li>mongoose - 1.7.3</li>
<li>jasmine-node - 1.0.6 (development)</li>
</ul>
</li>
<li>Ruby

<ul>
<li>heroku - 2.3.6</li>
<li>foreman - 0.18.0</li>
</ul>
</li>
</ul><h2>setup</h2>

<h3>local</h3>

<h4>1. install node</h4>

<p>make sure you have node installed. <strong>Version 0.4.7</strong> if you want to run on heroku. </p>

<pre><code>brew install node -v0.4.7
</code></pre>

<p>Do whatever it says to get your <code>NODE_PATH</code> env variable set up.</p>

<h4>2. install <a href="http://npmjs.org/">npm</a>
</h4>

<p>run the script, that should be enough to get started.</p>

<h4>3. clone the repo</h4>

<p>that's a secret</p>

<h4>4. install dependencies</h4>

<p>I think you cd into the project directory and type <code>npm install .</code>. Not sure, but 
I have them installed, so maybe that worked? YMMV. </p>

<p>To install mongo, all I did was <code>brew install mongo</code> and everything just worked.</p>

<h4>5. (optional) heroku support</h4>

<p>You'll need ruby for this. Get it. I recommend <a href="http://rvm.beginrescueend.com/">rvm</a>.</p>

<ol>
<li><code>gem install heroku</code></li>
<li><code>gem install foreman</code></li>
</ol><p>That's all.</p>

<h3>heroku</h3>

<ol>
<li><code>git push heroku master</code></li>
<li>setup 30m ping on <a href="http://www.montastic.com/">http://www.montastic.com/</a> to make sure the app doesn't get shut off. Heroku 
automatically turns off any dynos that haven't had a request in the last hour.</li>
</ol><h2>hacking</h2>

<h3>local env</h3>

<p>I keep a .profile file in my project directory and source it in my shell before
I start working. This lets me keep private stuff out of the code. It looks like this:</p>

<pre><code>export campfire_bot_token=12345thisisthetokencampfiregavemeweirdhuh
export campfire_bot_account=zoomakroom
export campfire_bot_room=100000     # staging
# export campfire_bot_room=900000   # production
export campfire_logging_room=100000 # bot chatter
export PATH=$(npm bin):$PATH
</code></pre>

<p>I think that last PATH=$(npm bin):$PATH line is what keeps me, node, foreman,
and npm happy in my local dev environment.</p>

<p>Wherever you deploy, you'll need those four <code>campfire_*</code> environment variables.</p>

<h3>running the app</h3>

<p>Code you write lives in src/. Everything in lib/ is either straight vendored,
or generated by <code>cake build</code> or <code>foreman start coffee</code>.</p>

<p>When working on the code, running <code>foreman start coffee</code> is recommended to make
sure lib/ stays up to date. To run the application, run <code>node lib/bot.js</code> or
<code>foreman start web</code>. Plain <code>foreman start</code> will run the coffee script updater and 
the web service, but the code won't be up to date when it starts (race condition) 
and the application server doesn't auto-load updated modules. So, you'll have to 
stop and restart the server to see your changes.</p>

<h3>plugins</h3>

<p>Plugins live in <code>src/plugins</code>. All plugins export an object with a <code>listen</code>
property which is a function. A basic echo plugin would look like this: </p>

<p><code>src/plugins/echo.coffee</code></p>

<pre><code>module.exports = 
  listen: (message, room) -&gt; room.speak(message.body, console.log)
</code></pre>

<p>The listen method should take two arguments, <code>message</code> the message object
handed over from Campfire and <code>room</code>, the Campfire room the message came from.</p>

<p>If you want to access the storage classes (User, Quote, Counter, etc.) you will
have to require <code>./lib/store</code> in the plugin. Take a look at
<code>src/plugins/phrases.coffee</code> for an example.</p>

<hr><p>Based on <a href="http://quickleft.com/blog/building-quick-bot">"Quack-Bot: a campfire bot for Quick Left"</a></p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/abachman">abachman</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>